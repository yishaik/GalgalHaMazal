<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>גלגל המזל – רשימת חלקים (BOM)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style> body { font-family: 'Assistant','Segoe UI',Tahoma,Geneva,Verdana,sans-serif } .container{max-width:1100px;} table{border-collapse:collapse} th,td{border-bottom:1px solid #eee;padding:.5rem} </style>
</head>
<body class="bg-gray-50 text-gray-800">
  <header class="bg-white border-b">
    <div class="container mx-auto px-4 py-4 flex items-center justify-between">
      <a class="text-xl font-bold" href="index.html">גלגל המזל</a>
      <button id="navToggle" class="md:hidden inline-flex items-center justify-center p-2 rounded border text-gray-600 hover:bg-gray-50" aria-label="פתח תפריט" aria-expanded="false">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
      </button>
      <nav id="siteNav" class="hidden md:flex flex-col md:flex-row md:items-center gap-2 md:gap-6 text-sm">
        <a class="text-gray-600 hover:text-gray-900" href="index.html">בית</a>
        <a class="text-gray-600 hover:text-gray-900" href="overview.html">סקירה</a>
        <a class="text-gray-600 hover:text-gray-900" href="architecture.html">תרשים מערכת</a>
        <a class="text-gray-600 hover:text-gray-900" href="wiring.html">תרשים חיווט</a>
        <a class="text-gray-900 font-semibold" href="bom.html">רשימת חלקים</a>
        <a class="text-gray-600 hover:text-gray-900" href="gallery.html">גלריה</a>
        <a class="text-gray-600 hover:text-gray-900" href="docs.html">מסמכים</a>
        <a class="text-gray-600 hover:text-gray-900" href="missing.html">מה חסר?</a>
      </nav>
    </div>
  </header>

  <main class="container mx-auto px-4 py-10 space-y-6">
    <h1 class="text-2xl font-bold">רשימת חלקים (BOM)</h1>
    <div class="bg-white rounded-xl shadow p-4">
      <div class="flex flex-wrap gap-4 mb-4 items-center">
        <label class="text-sm">
          קטגוריה:
          <select id="cat" class="border rounded px-2 py-1 text-sm">
            <option value="">הכל</option>
          </select>
        </label>
        <label class="text-sm">
          חיפוש:
          <input id="q" class="border rounded px-2 py-1 text-sm" placeholder="מילה חופשית" />
        </label>
        <button id="downloadCsv" class="ml-auto bg-gray-100 hover:bg-gray-200 rounded px-3 py-1 text-sm">הורד CSV</button>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-[720px] w-full text-sm" id="bomTable">
          <thead class="bg-gray-50">
            <tr>
              <th class="text-right">קטגוריה</th>
              <th class="text-right">חלק/סוג</th>
              <th class="text-right">מפרט/ערך</th>
              <th class="text-right">כמות</th>
              <th class="text-right">הערות</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </main>

  <footer class="border-t bg-white">
    <div class="container mx-auto px-4 py-6 text-sm text-gray-500">© גלגל המזל</div>
  </footer>
  <script>
    async function loadCSV(url){
      const res = await fetch(url);
      const text = await res.text();
      const lines = text.trim().split(/\r?\n/);
      const [header, ...rows] = lines;
      return rows.map(line => {
        const parts = [];
        let cur = '', inQuote = false;
        for (let i=0;i<line.length;i++){
          const ch = line[i];
          if (ch === '"') inQuote = !inQuote;
          else if (ch === ',' && !inQuote){ parts.push(cur); cur=''; }
          else cur += ch;
        }
        parts.push(cur);
        const [Category, Part, Spec, Quantity, Notes] = parts.map(s=>s.replace(/^"|"$/g,''));
        return {Category, Part, Spec, Quantity, Notes};
      });
    }
    function render(rows){
      const tbody = document.querySelector('#bomTable tbody');
      tbody.innerHTML = rows.map(r => `
        <tr>
          <td>${r.Category||''}</td>
          <td>${r.Part||''}</td>
          <td>${r.Spec||''}</td>
          <td>${r.Quantity||''}</td>
          <td>${r.Notes||''}</td>
        </tr>`).join('');
    }
    function unique(arr){ return Array.from(new Set(arr)).sort(); }
    (async () => {
      const rows = await loadCSV('assets/data/BOM.csv');
      const catSel = document.getElementById('cat');
      unique(rows.map(r=>r.Category)).forEach(c => {
        const opt = document.createElement('option');
        opt.value = c; opt.textContent = c; catSel.appendChild(opt);
      });
      const q = document.getElementById('q');
      function apply(){
        const cat = catSel.value.trim();
        const term = (q.value||'').toLowerCase();
        const f = rows.filter(r => (!cat || r.Category===cat) && (!term || Object.values(r).some(v => (v||'').toLowerCase().includes(term))));
        render(f);
      }
      catSel.addEventListener('change', apply);
      q.addEventListener('input', apply);
      document.getElementById('downloadCsv').addEventListener('click', ()=>{
        const a = document.createElement('a');
        a.href = 'assets/data/BOM.csv';
        a.download = 'BOM.csv';
        a.click();
      });
      render(rows);
    })();
  </script>
  <script>
    const btn = document.getElementById('navToggle');
    const nav = document.getElementById('siteNav');
    if (btn && nav) btn.addEventListener('click', ()=> nav.classList.toggle('hidden'));
  </script>
</body>
</html>
